#!/usr/bin/env bash
set -e

cd "$(dirname "$0")/.."

REQUIRED_VERSION=$(cat .python-version)
PYENV_PYTHON="$HOME/.pyenv/versions/$REQUIRED_VERSION/bin/python"

if command -v pyenv &> /dev/null; then
    if ! pyenv versions | grep -q "$REQUIRED_VERSION"; then
        echo "Python $REQUIRED_VERSION no está instalado. Instalando con pyenv..."
        pyenv install "$REQUIRED_VERSION"
    fi
fi

if [[ ! -f "$PYENV_PYTHON" ]]; then
    echo "Error: Python $REQUIRED_VERSION no encontrado en $PYENV_PYTHON"
    echo "Instala la versión correcta con: pyenv install $REQUIRED_VERSION"
    exit 1
fi

echo "Usando Python $REQUIRED_VERSION desde pyenv"
"$PYENV_PYTHON" -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# Registrar kernel para Jupyter
python -m ipykernel install --user --name jeke-xg --display-name "Python (jeke-xg)"

echo ""
echo "Setup completado. Activa el entorno con:"
echo "  source .venv/bin/activate"
